apiVersion: bigquery.cnrm.cloud.google.com/v1beta1
kind: BigQueryDataset
metadata:
  name: dreamnet-analytics
  labels:
    app: dreamnet
    environment: production
spec:
  projectRef:
    external: aqueous-tube-470317-m6
  location: US
  friendlyName: DreamNet Analytics
  description: Data warehouse for DreamNet analytics and ML
  defaultTableExpirationMs: 3600000  # 1 hour default
  defaultPartitionExpirationMs: 2592000000  # 30 days
  access:
    - role: OWNER
      userByEmail: brandonducar1234@gmail.com
    - role: READER
      groupByEmail: dreamnet-readers@dreamnet.ink
---
apiVersion: bigquery.cnrm.cloud.google.com/v1beta1
kind: BigQueryTable
metadata:
  name: dreamnet-analytics-dreams
spec:
  datasetRef:
    name: dreamnet-analytics
  tableId: dreams
  schema:
    - name: id
      type: STRING
      mode: REQUIRED
    - name: name
      type: STRING
      mode: REQUIRED
    - name: creator
      type: STRING
      mode: REQUIRED
    - name: score
      type: INTEGER
      mode: NULLABLE
    - name: created_at
      type: TIMESTAMP
      mode: REQUIRED
    - name: tags
      type: STRING
      mode: REPEATED
  timePartitioning:
    type: DAY
    field: created_at
  clustering:
    - creator
    - score

