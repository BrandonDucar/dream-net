# Wolf Pack Testing & Dashboard Guide

## Overview

This guide walks you through testing the Wolf Pack funding system end-to-end and using the funding dashboard.

## Quick Start: End-to-End Test (Recommended)

**Run the complete test sequence in one command:**

```bash
pnpm wolfpack:test
```

or

```bash
tsx scripts/runWolfpackEndToEndTest.ts
```

This single script will:
1. ✅ Seed a test lead (using `TEST_LEAD_EMAIL` from `.env`)
2. ✅ Run funding cycle (lead → queue)
3. ✅ Run mailer (queue → real email)
4. ✅ Show clear before/after snapshots

**Expected Output:**
- Lead seeded with your email
- Queue item generated
- Email sent successfully
- Final summary with next steps

**Then check your inbox** for the email from "DreamNet Wolf Pack"!

---

## Manual Step-by-Step Testing (Alternative)

If you prefer to run each step individually:

## Step 1: Set Environment Variables

First, set up your environment variables:

```bash
# Copy the example file
cp .env.example .env

# Edit .env and set:
# - WOLFMAIL_SMTP_PASS (your Gmail App Password - see .env.example for instructions)
# - TEST_LEAD_EMAIL (your email address to receive test emails)
```

**Important:** `WOLFMAIL_SMTP_PASS` must be a **Gmail App Password**, not your regular password.
See `.env.example` for instructions on creating one.

## Step 2: Seed a Test Lead

Create a test lead with your own email:

```bash
# Option 1: Set TEST_LEAD_EMAIL in .env file
# Option 2: Edit scripts/seedWolfpackTestLead.ts directly
# Then run:
tsx scripts/seedWolfpackTestLead.ts
```

**Expected Output:**
```
Seeded lead. Status: {
  leadCount: 1,
  sampleLeads: [ { id: 'lead:test-self', name: 'Test Self Lead', ... } ]
}
```

## Step 3: Run Funding Cycle Once

Test that the funding core can score leads and generate queue items:

```bash
tsx scripts/runWolfpackFundingOnce.ts
```

**Expected Output:**
```
Before run: { leadCount: 1, queueCount: 0, pendingCount: 0 }
After run: {
  leadCount: 1,
  queueCount: 1,        // ✅ Should be ≥ 1
  pendingCount: 1,      // ✅ Should be ≥ 1
  sampleQueue: [ { id: '...', toEmail: 'your-email@...', status: 'pending' } ]
}
```

This means Wolf Pack:
- Scored your lead
- Generated an email draft
- Queued it for sending

## Step 4: Run Mailer Once (Send Real Email)

**⚠️ Requires SMTP Environment Variables**

Make sure your `.env` file has all the `WOLFMAIL_*` variables set (see Step 1).

Then run:
```bash
tsx scripts/runWolfpackMailerOnce.ts
```

**Expected Output:**
```
Queue BEFORE: { queueCount: 1, pendingCount: 1 }
Processing Wolf Pack send queue once...
[WolfPackMailer] Processing 1 pending email(s)...
[WolfPackMailer] ✓ Email sent successfully to your-email@...
Queue AFTER: { queueCount: 1, pendingCount: 0 }  // ✅ pendingCount should be 0
```

**Check Your Email:**
- You should receive an email from "DreamNet Wolf Pack"
- Subject: Something like "Partnership Opportunity: DreamNet"
- Body: Personalized email draft generated by Wolf Pack

## Step 5: View Funding Dashboard

Once the core loop is proven, view the dashboard:

1. Start your frontend dev server
2. Navigate to: `http://localhost:5000/system/funding`

**Dashboard Features:**
- **Metrics Cards**: Leads, Queue Items, Pending, Hot Leads
- **Leads Table**: Shows all leads with stage, priority score, email
- **Queue Table**: Shows email queue with status (pending/sent/failed)
- **Auto-refresh**: Updates every 30 seconds
- **Manual Refresh**: Click the refresh button

## Step 6: Run the Service Worker

Once everything works in isolation, start the background service:

```bash
# Build the service
pnpm --filter @dreamnet/dreamnet-funding-service build

# Run it
pnpm --filter @dreamnet/dreamnet-funding-service start
```

The service will:
- Run funding cycle every 30 minutes (configurable via `WOLF_FUNDING_INTERVAL_MIN`)
- Process send queue after each cycle
- Log all activity to console

## Files Created

### Test Scripts
- `scripts/seedWolfpackTestLead.ts` - Seed a test lead
- `scripts/runWolfpackFundingOnce.ts` - Test funding cycle
- `scripts/runWolfpackMailerOnce.ts` - Test email sending

### Backend Adapter
- `packages/wolfpack-funding-core/adapters/fundingStatusAdapter.ts` - Dashboard view model

### Frontend
- `client/src/pages/SystemFundingPage.tsx` - Funding dashboard UI
- Route: `/system/funding`

## Troubleshooting

### "No leads yet"
- Run `tsx scripts/seedWolfpackTestLead.ts` first

### "Queue is empty"
- Run `tsx scripts/runWolfpackFundingOnce.ts` to generate queue items

### "WOLFMAIL_SMTP_PASS is not set"
- Set your Gmail App Password in environment variables
- See `services/dreamnet-funding-service/README.md` for full env var list

### Email not sending
- Check SMTP credentials are correct
- Verify Gmail App Password (not regular password)
- Check console for error messages

### Dashboard shows mock data
- The dashboard currently uses a mock function
- TODO: Wire up API route or direct import of `getFundingDashboardView()`

## Next Steps

1. ✅ Test scripts created
2. ✅ Dashboard adapter created
3. ✅ Frontend page created
4. ⚠️ TODO: Wire dashboard to real data (API route or direct import)
5. ⚠️ TODO: Add more test leads with different stages
6. ⚠️ TODO: Add filtering/sorting to dashboard tables

